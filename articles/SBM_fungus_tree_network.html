<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simple and Bipartite Stochastic Block Models • sbm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simple and Bipartite Stochastic Block Models">
<meta property="og:description" content="sbm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sbm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a>
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/SBM_fungus_tree_network.html">Fungus-tree interaction with simple and bipartite SBM</a>
    </li>
    <li>
      <a href="../articles/Multipartite_EcologicalNetwork.html">Mutualistic ecological network with multipartite SBM</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/GrossSBM/GSBM" class="external-link">
    <span class="fas fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="SBM_fungus_tree_network_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Simple and Bipartite Stochastic Block Models</h1>
            <h3 data-toc-skip class="subtitle">An illustration on antogonistic tree/fungus network</h3>
                        <h4 data-toc-skip class="author">team großBM</h4>
            
            <h4 data-toc-skip class="date">2021-05-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/GrossSBM/sbm/blob/master/vignettes/SBM_fungus_tree_network.Rmd" class="external-link"><code>vignettes/SBM_fungus_tree_network.Rmd</code></a></small>
      <div class="hidden name"><code>SBM_fungus_tree_network.Rmd</code></div>

    </div>

    
    
<div id="preliminaries" class="section level2">
<h2 class="hasAnchor">
<a href="#preliminaries" class="anchor" aria-hidden="true"></a>Preliminaries</h2>
<p>This vignette illustrates the use of the <code>estimateSBM</code> function and the methods accompanying the R6 classes <code>SimpleSBMfit</code> and <code>BipartiteSBMfit</code>.</p>
<div id="requirements" class="section level3">
<h3 class="hasAnchor">
<a href="#requirements" class="anchor" aria-hidden="true"></a>Requirements</h3>
<p>The packages required for the analysis are <strong>sbm</strong> plus some others for data manipulation and representation:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://grosssbm.github.io/sbm/" class="external-link">sbm</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="data-set-antagonistic-treefungus-interaction-network" class="section level3">
<h3 class="hasAnchor">
<a href="#data-set-antagonistic-treefungus-interaction-network" class="anchor" aria-hidden="true"></a>Data set: antagonistic tree/fungus interaction network</h3>
<p>We consider the fungus-tree interaction network studied by <span class="citation">Vacher, Piou, and Desprez-Loustau (<a href="#ref-tree_fungus_network" role="doc-biblioref">2008</a>)</span>, available with the package <strong>sbm</strong>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"fungusTreeNetwork"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">fungusTreeNetwork</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; List of 5</span>
<span class="co">#&gt;  $ tree_names  : Factor w/ 51 levels "Abies alba","Abies grandis",..: 1 2 3 14 42 4 5 6 7 8 ...</span>
<span class="co">#&gt;  $ fungus_names: Factor w/ 154 levels "Amphiporthe leiphaemia",..: 1 2 3 4 5 6 7 8 9 10 ...</span>
<span class="co">#&gt;  $ tree_tree   : num [1:51, 1:51] 0 12 9 3 2 2 0 0 2 7 ...</span>
<span class="co">#&gt;  $ fungus_tree : int [1:154, 1:51] 0 0 0 0 1 1 1 0 0 0 ...</span>
<span class="co">#&gt;  $ covar_tree  :List of 3</span></code></pre></div>
<p>This data set provides information about <span class="math inline">\(154\)</span> fungi sampled on <span class="math inline">\(51\)</span> tree species. It is a list with the following entries:</p>
<ul>
<li>
<code>fungi_list</code>: list of the fungus species names</li>
<li>
<code>tree_list</code> : list of the tree species names</li>
<li>
<code>fungus_tree</code> : binary fungus-tree interactions</li>
<li>
<code>tree_tree</code> : weighted tree-tree interactions (number of common fungal species two tree species host)</li>
<li>
<code>covar_tree</code> : covariates associated to pairs of trees (namely genetic, taxonomic and geographic distances)</li>
</ul>
<p>We first consider the tree-tree interactions resulting into a Simple Network. Then we consider the bipartite network between trees and fungi.</p>
</div>
<div id="mathematical-background" class="section level3">
<h3 class="hasAnchor">
<a href="#mathematical-background" class="anchor" aria-hidden="true"></a>Mathematical Background</h3>
<p>See <span class="citation">Leger (<a href="#ref-blockmodels" role="doc-biblioref">2016</a>)</span> for details.</p>
</div>
</div>
<div id="analysis-of-the-treetree-data" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis-of-the-treetree-data" class="anchor" aria-hidden="true"></a>Analysis of the tree/tree data</h2>
<div id="tree-tree-binary-interaction-networks" class="section level3">
<h3 class="hasAnchor">
<a href="#tree-tree-binary-interaction-networks" class="anchor" aria-hidden="true"></a>Tree-tree binary interaction networks</h3>
<p>We first consider the binary network where an edge is drawn between two trees when they do share a least one common fungi:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree_tree_binary</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">*</span> <span class="op">(</span><span class="va">fungusTreeNetwork</span><span class="op">$</span><span class="va">tree_tree</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>The simple function <code>plotMyMatrix</code> can be use to represent simple or bipartite SBM:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotMyMatrix.html">plotMyMatrix</a></span><span class="op">(</span><span class="va">tree_tree_binary</span>, dimLabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>row <span class="op">=</span> <span class="st">'tree'</span>, col <span class="op">=</span> <span class="st">'tree'</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
<p><img src="SBM_fungus_tree_network_files/figure-html/tree_tree_binary%20network%20plot%20data-1.png" width="700"></p>
<p>We look for some latent structure of the network by adjusting a simple SBM with the function <code>estimateSimpleSBM</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mySimpleSBM</span> <span class="op">&lt;-</span> <span class="va">tree_tree_binary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/estimateSimpleSBM.html">estimateSimpleSBM</a></span><span class="op">(</span><span class="st">"bernoulli"</span>, dimLabels <span class="op">=</span> <span class="st">'tree'</span>, estimOptions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>verbosity <span class="op">=</span> <span class="fl">0</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Once fitted, the user can manipulate the fitted model by accessing the various fields and methods enjoyed by the class <code>simpleSBMfit</code>. Most important fields and methods are recalled to the user via the <code>show</code> method:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">mySimpleSBM</span><span class="op">)</span>
<span class="co">#&gt; [1] "SimpleSBM_fit" "SimpleSBM"     "SBM"           "R6"</span>
<span class="va">mySimpleSBM</span>
<span class="co">#&gt; Fit of a Simple Stochastic Block Model -- bernoulli variant</span>
<span class="co">#&gt; =====================================================================</span>
<span class="co">#&gt; Dimension = ( 51 ) - ( 5 ) blocks and no covariate(s).</span>
<span class="co">#&gt; =====================================================================</span>
<span class="co">#&gt; * Useful fields </span>
<span class="co">#&gt;   $nbNodes, $modelName, $dimLabels, $nbBlocks, $nbCovariates, $nbDyads</span>
<span class="co">#&gt;   $blockProp, $connectParam, $covarParam, $covarList, $covarEffect </span>
<span class="co">#&gt;   $expectation, $indMemberships, $memberships </span>
<span class="co">#&gt; * R6 and S3 methods </span>
<span class="co">#&gt;   $rNetwork, $rMemberships, $rEdges, plot, print, coef </span>
<span class="co">#&gt; * Additional fields</span>
<span class="co">#&gt;   $probMemberships, $loglik, $ICL, $storedModels, </span>
<span class="co">#&gt; * Additional methods </span>
<span class="co">#&gt;   predict, fitted, $setModel, $reorder</span></code></pre></div>
<p>For instance,</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mySimpleSBM</span><span class="op">$</span><span class="va">nbBlocks</span>
<span class="co">#&gt; [1] 5</span>
<span class="va">mySimpleSBM</span><span class="op">$</span><span class="va">nbNodes</span>
<span class="co">#&gt; tree </span>
<span class="co">#&gt;   51</span>
<span class="va">mySimpleSBM</span><span class="op">$</span><span class="va">nbCovariates</span>
<span class="co">#&gt; [1] 0</span></code></pre></div>
<p>The plot method is available as a S3 or R6 method. The default represents the network data reordered according to the memberships estimated in the SBM</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mySimpleSBM</span>, type <span class="op">=</span> <span class="st">"data"</span>, dimLabels  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>row <span class="op">=</span> <span class="st">'tree'</span>, col<span class="op">=</span> <span class="st">'tree'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="SBM_fungus_tree_network_files/figure-html/simpleSBMfit%20plot1-1.png" width="700"></p>
<p>One can also plot the expected network which, in case of the Bernoulli model, corresponds to the probability of connection between any pair of nodes in the network.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mySimpleSBM</span>, type <span class="op">=</span> <span class="st">"expected"</span><span class="op">)</span></code></pre></div>
<p><img src="SBM_fungus_tree_network_files/figure-html/simpleSBMfit%20plot2-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mySimpleSBM</span>, type <span class="op">=</span> <span class="st">"meso"</span><span class="op">)</span></code></pre></div>
<p><img src="SBM_fungus_tree_network_files/figure-html/simpleSBMfit%20plotmeso-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mySimpleSBM</span>, <span class="st">'block'</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.3320954 0.1766383 0.1378665 0.1766999 0.1766999</span>
<span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mySimpleSBM</span>, <span class="st">'connectivity'</span><span class="op">)</span>
<span class="co">#&gt; $mean</span>
<span class="co">#&gt;            [,1]      [,2]       [,3]       [,4]       [,5]</span>
<span class="co">#&gt; [1,] 0.98230909 0.9828930 0.92749023 0.60851311 0.05994511</span>
<span class="co">#&gt; [2,] 0.98289303 0.9937459 0.29390960 0.91904879 0.22617761</span>
<span class="co">#&gt; [3,] 0.92749023 0.2939096 0.79890626 0.05802394 0.02169247</span>
<span class="co">#&gt; [4,] 0.60851311 0.9190488 0.05802394 0.47209785 0.06626655</span>
<span class="co">#&gt; [5,] 0.05994511 0.2261776 0.02169247 0.06626655 0.02899357</span></code></pre></div>
<div id="about-model-selection-and-choice-of-the-number-of-blocks" class="section level4">
<h4 class="hasAnchor">
<a href="#about-model-selection-and-choice-of-the-number-of-blocks" class="anchor" aria-hidden="true"></a>About model selection and choice of the number of blocks</h4>
<p>During the estimation, a certain range of models are explored corresponding to different number of blocks. By default, the best model in terms of Integrated Classification Likelihood is sent back. In fact, all the model are stored internally. The user can have a quick glance at them via the <code>$storedModels</code> field:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mySimpleSBM</span><span class="op">$</span><span class="va">storedModels</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">indexModel</th>
<th align="right">nbParams</th>
<th align="right">nbBlocks</th>
<th align="right">ICL</th>
<th align="right">loglik</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-883.3334</td>
<td align="right">-879.7581</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="right">-619.0799</td>
<td align="right">-606.3880</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">8</td>
<td align="right">3</td>
<td align="right">-537.5179</td>
<td align="right">-512.1339</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">13</td>
<td align="right">4</td>
<td align="right">-540.6318</td>
<td align="right">-498.9806</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">19</td>
<td align="right">5</td>
<td align="right">-520.6645</td>
<td align="right">-459.1706</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">26</td>
<td align="right">6</td>
<td align="right">-530.6278</td>
<td align="right">-445.7159</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">34</td>
<td align="right">7</td>
<td align="right">-544.0191</td>
<td align="right">-432.1138</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">43</td>
<td align="right">8</td>
<td align="right">-562.1450</td>
<td align="right">-419.6710</td>
</tr>
</tbody>
</table>
<p>We can then what models are competitive in terms of model selection by checking the ICL</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mySimpleSBM</span><span class="op">$</span><span class="va">storedModels</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">nbBlocks</span>, y <span class="op">=</span> <span class="va">ICL</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="SBM_fungus_tree_network_files/figure-html/simpleSBM%20ICL-1.png" width="700"></p>
<p>The 4-block model could have been a good choice too, in place of the 5-block model. The user can update the current <code>simpleSBMfit</code> thanks to the the <code>setModel</code> method:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mySimpleSBM</span><span class="op">$</span><span class="fu">setModel</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>
<span class="va">mySimpleSBM</span><span class="op">$</span><span class="va">nbBlocks</span>
<span class="co">#&gt; [1] 4</span>
<span class="va">mySimpleSBM</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>type <span class="op">=</span> <span class="st">'expected'</span><span class="op">)</span></code></pre></div>
<p><img src="SBM_fungus_tree_network_files/figure-html/simpleSBMfit%20changeModel-1.png" width="700"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mySimpleSBM</span><span class="op">$</span><span class="fu">setModel</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="analysis-of-the-weighted-interaction-network" class="section level3">
<h3 class="hasAnchor">
<a href="#analysis-of-the-weighted-interaction-network" class="anchor" aria-hidden="true"></a>Analysis of the weighted interaction network</h3>
<p>Instead of considering the binary network tree-tree we may consider the weighted network where the link between two trees is the number of fungi they share.</p>
<p>We plot the matrix with function <code>plotMyMatrix</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree_tree</span> <span class="op">&lt;-</span> <span class="va">fungusTreeNetwork</span><span class="op">$</span><span class="va">tree_tree</span>
<span class="fu"><a href="../reference/plotMyMatrix.html">plotMyMatrix</a></span><span class="op">(</span><span class="va">tree_tree</span>, dimLabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>row <span class="op">=</span> <span class="st">'tree'</span>, col <span class="op">=</span> <span class="st">'tree'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="SBM_fungus_tree_network_files/figure-html/tree_tree%20network%20plot%20data-1.png" width="700"></p>
<p>Here again, we look for some latent structure of the network by adjusting a simple SBM with the function <code>estimateSimpleSBM</code>, considering a Poisson distribution on the edges.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mySimpleSBMPoisson</span> <span class="op">&lt;-</span> <span class="va">tree_tree</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/estimateSimpleSBM.html">estimateSimpleSBM</a></span><span class="op">(</span><span class="st">"poisson"</span>, dimLabels <span class="op">=</span> <span class="st">'tree'</span>, estimOptions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>verbosity <span class="op">=</span> <span class="fl">0</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Once fitted, the user can manipulate the fitted model by accessing the various fields and methods enjoyed by the class <code>simpleSBMfit</code>. Most important fields and methods are recalled to the user via the <code>show</code> method:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">mySimpleSBMPoisson</span><span class="op">)</span>
<span class="co">#&gt; [1] "SimpleSBM_fit" "SimpleSBM"     "SBM"           "R6"</span>
<span class="va">mySimpleSBMPoisson</span>
<span class="co">#&gt; Fit of a Simple Stochastic Block Model -- poisson variant</span>
<span class="co">#&gt; =====================================================================</span>
<span class="co">#&gt; Dimension = ( 51 ) - ( 6 ) blocks and no covariate(s).</span>
<span class="co">#&gt; =====================================================================</span>
<span class="co">#&gt; * Useful fields </span>
<span class="co">#&gt;   $nbNodes, $modelName, $dimLabels, $nbBlocks, $nbCovariates, $nbDyads</span>
<span class="co">#&gt;   $blockProp, $connectParam, $covarParam, $covarList, $covarEffect </span>
<span class="co">#&gt;   $expectation, $indMemberships, $memberships </span>
<span class="co">#&gt; * R6 and S3 methods </span>
<span class="co">#&gt;   $rNetwork, $rMemberships, $rEdges, plot, print, coef </span>
<span class="co">#&gt; * Additional fields</span>
<span class="co">#&gt;   $probMemberships, $loglik, $ICL, $storedModels, </span>
<span class="co">#&gt; * Additional methods </span>
<span class="co">#&gt;   predict, fitted, $setModel, $reorder</span></code></pre></div>
<p>For instance,</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mySimpleSBMPoisson</span><span class="op">$</span><span class="va">nbBlocks</span>
<span class="co">#&gt; [1] 6</span>
<span class="va">mySimpleSBMPoisson</span><span class="op">$</span><span class="va">nbNodes</span>
<span class="co">#&gt; tree </span>
<span class="co">#&gt;   51</span>
<span class="va">mySimpleSBMPoisson</span><span class="op">$</span><span class="va">nbCovariates</span>
<span class="co">#&gt; [1] 0</span></code></pre></div>
<p>We now plot the matrix reordered according to the memberships estimated in the SBM</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mySimpleSBMPoisson</span>, type <span class="op">=</span> <span class="st">"data"</span>, dimLabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>row <span class="op">=</span> <span class="st">'tree'</span>, col<span class="op">=</span> <span class="st">'tree'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="SBM_fungus_tree_network_files/figure-html/simpleSBMfitPoisson%20plot1-1.png" width="700"></p>
<p>One can also plot the expected network which, in case of the Poisson model, corresponds to the expectation of connection between any pair of nodes in the network.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mySimpleSBMPoisson</span>, type <span class="op">=</span> <span class="st">"expected"</span>, dimLabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>row <span class="op">=</span> <span class="st">'tree'</span>, col<span class="op">=</span> <span class="st">'tree'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="SBM_fungus_tree_network_files/figure-html/simpleSBMfitPoisson%20plot2-1.png" width="700"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mySimpleSBMPoisson</span>, type <span class="op">=</span> <span class="st">"meso"</span><span class="op">)</span></code></pre></div>
<p><img src="SBM_fungus_tree_network_files/figure-html/simpleSBMfitPoisson%20plotmeso-1.png" width="700"></p>
<p>The same manipulations can be made on the models as before.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mySimpleSBMPoisson</span>, <span class="st">'block'</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.1763561 0.1957351 0.1375982 0.1569772 0.1569772 0.1763561</span>
<span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mySimpleSBMPoisson</span>, <span class="st">'connectivity'</span><span class="op">)</span>
<span class="co">#&gt; $mean</span>
<span class="co">#&gt;           [,1]      [,2]       [,3]       [,4]       [,5]       [,6]</span>
<span class="co">#&gt; [1,] 9.0286270 3.2910355 6.04727443 1.06850270 1.85464212 0.11062572</span>
<span class="co">#&gt; [2,] 3.2910355 5.9646020 1.33637565 2.17610068 0.49999123 0.26547703</span>
<span class="co">#&gt; [3,] 6.0472744 1.3363757 3.94065914 0.40263458 1.46245649 0.07080814</span>
<span class="co">#&gt; [4,] 1.0685027 2.1761007 0.40263458 0.82166374 0.14089332 0.07793391</span>
<span class="co">#&gt; [5,] 1.8546421 0.4999912 1.46245649 0.14089332 0.54121406 0.02263218</span>
<span class="co">#&gt; [6,] 0.1106257 0.2654770 0.07080814 0.07793391 0.02263218 0.02940543</span></code></pre></div>
</div>
<div id="introduction-of-covariates" class="section level3">
<h3 class="hasAnchor">
<a href="#introduction-of-covariates" class="anchor" aria-hidden="true"></a>Introduction of covariates</h3>
<p>We have on each pair of trees 3 covariates, namely the genetic distance, the taxonomic distance and the geographic distance. Each covariate has to be introduced as a matrix: <span class="math inline">\(X^k_{ij}\)</span> corresponds to the value of the <span class="math inline">\(k\)</span>-th covariate describing the couple <span class="math inline">\((i,j)\)</span>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mySimpleSBMCov</span><span class="op">&lt;-</span> 
  <span class="va">tree_tree</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/estimateSimpleSBM.html">estimateSimpleSBM</a></span><span class="op">(</span>
    model <span class="op">=</span> <span class="st">'poisson'</span>, 
    directed <span class="op">=</span> <span class="cn">FALSE</span>, 
    dimLabels <span class="op">=</span> <span class="st">'tree'</span>,
    covariates  <span class="op">=</span> <span class="va">fungusTreeNetwork</span><span class="op">$</span><span class="va">covar_tree</span>, 
    estimOptions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>verbosity <span class="op">=</span> <span class="fl">0</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, nbCores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<ul>
<li>We select the best number of clusters (with respect to the ICL criteria)</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mySimpleSBMCov</span><span class="op">$</span><span class="va">nbBlocks</span>
<span class="co">#&gt; [1] 4</span></code></pre></div>
<ul>
<li>We can now extract the parameters of interest, namely (<span class="math inline">\(\lambda\)</span>, <span class="math inline">\(\pi\)</span>) and the clustering of the nodes.</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mySimpleSBMCov</span><span class="op">$</span><span class="va">connectParam</span>
<span class="co">#&gt; $mean</span>
<span class="co">#&gt;           [,1]       [,2]      [,3]      [,4]</span>
<span class="co">#&gt; [1,] 28.178687 14.8817269 5.9555364 1.2389235</span>
<span class="co">#&gt; [2,] 14.881727  9.5536596 3.7925162 0.4095118</span>
<span class="co">#&gt; [3,]  5.955536  3.7925162 1.6181930 0.3840766</span>
<span class="co">#&gt; [4,]  1.238923  0.4095118 0.3840766 0.1891657</span>
<span class="va">mySimpleSBMCov</span><span class="op">$</span><span class="va">blockProp</span>
<span class="co">#&gt; [1] 0.3715916 0.2159544 0.2354118 0.1770423</span>
<span class="va">mySimpleSBMCov</span><span class="op">$</span><span class="va">memberships</span>
<span class="co">#&gt;  [1] 1 1 2 1 2 2 4 4 2 1 3 1 1 1 1 2 1 2 3 3 2 1 2 1 3 3 2 1 3 2 3 1 4 1 1 3 1 3</span>
<span class="co">#&gt; [39] 4 1 1 3 2 4 4 1 4 4 3 3 4</span>
<span class="va">mySimpleSBMCov</span><span class="op">$</span><span class="va">covarParam</span>
<span class="co">#&gt;           [,1]</span>
<span class="co">#&gt; [1,]  0.197846</span>
<span class="co">#&gt; [2,] -2.054827</span>
<span class="co">#&gt; [3,] -0.357703</span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mySimpleSBMCov</span>, <span class="st">'covariates'</span><span class="op">)</span>
<span class="co">#&gt;           [,1]</span>
<span class="co">#&gt; [1,]  0.197846</span>
<span class="co">#&gt; [2,] -2.054827</span>
<span class="co">#&gt; [3,] -0.357703</span></code></pre></div>
<p>S3 methods are also available for fit and prediction (results hidden here)</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">mySimpleSBMCov</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mySimpleSBMCov</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mySimpleSBMCov</span>, <span class="va">fungusTreeNetwork</span><span class="op">$</span><span class="va">covar_tree</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="analysis-of-the-treefungi-data" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis-of-the-treefungi-data" class="anchor" aria-hidden="true"></a>Analysis of the tree/fungi data</h2>
<p>We now analyze the bipartite tree/fungi interactions. The incidence matrix can be plotted with the function </p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotMyMatrix.html">plotMyMatrix</a></span><span class="op">(</span><span class="va">fungusTreeNetwork</span><span class="op">$</span><span class="va">fungus_tree</span>, dimLabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>row <span class="op">=</span> <span class="st">'fungis'</span>, col<span class="op">=</span> <span class="st">'tree'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="SBM_fungus_tree_network_files/figure-html/plot%20incidence-1.png" width="700"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myBipartiteSBM</span> <span class="op">&lt;-</span> 
  <span class="va">fungusTreeNetwork</span><span class="op">$</span><span class="va">fungus_tree</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/estimateBipartiteSBM.html">estimateBipartiteSBM</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">'bernoulli'</span>, dimLabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'fungis'</span>, <span class="st">'tree'</span><span class="op">)</span>,estimOptions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>verbosity <span class="op">=</span> <span class="fl">0</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myBipartiteSBM</span><span class="op">$</span><span class="va">nbNodes</span>
<span class="co">#&gt; fungis   tree </span>
<span class="co">#&gt;    154     51</span>
<span class="va">myBipartiteSBM</span><span class="op">$</span><span class="va">nbBlocks</span>
<span class="co">#&gt; row col </span>
<span class="co">#&gt;   4   4</span>
<span class="va">myBipartiteSBM</span><span class="op">$</span><span class="va">connectParam</span>
<span class="co">#&gt; $mean</span>
<span class="co">#&gt;            [,1]        [,2]        [,3]        [,4]</span>
<span class="co">#&gt; [1,] 0.96813478 0.077538579 0.840370657 0.067563355</span>
<span class="co">#&gt; [2,] 0.52055882 0.584398216 0.230893917 0.107930384</span>
<span class="co">#&gt; [3,] 0.32450427 0.003624764 0.098526840 0.005780612</span>
<span class="co">#&gt; [4,] 0.01834547 0.154334411 0.001330278 0.019219920</span>
<span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">myBipartiteSBM</span>, <span class="st">'block'</span><span class="op">)</span>
<span class="co">#&gt; $row</span>
<span class="co">#&gt; [1] 0.02655516 0.05570334 0.31666508 0.60107642</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $col</span>
<span class="co">#&gt; [1] 0.1050494 0.1963968 0.2477304 0.4508234</span>
<span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">myBipartiteSBM</span>, <span class="st">'connectivity'</span><span class="op">)</span>
<span class="co">#&gt; $mean</span>
<span class="co">#&gt;            [,1]        [,2]        [,3]        [,4]</span>
<span class="co">#&gt; [1,] 0.96813478 0.077538579 0.840370657 0.067563355</span>
<span class="co">#&gt; [2,] 0.52055882 0.584398216 0.230893917 0.107930384</span>
<span class="co">#&gt; [3,] 0.32450427 0.003624764 0.098526840 0.005780612</span>
<span class="co">#&gt; [4,] 0.01834547 0.154334411 0.001330278 0.019219920</span></code></pre></div>
<p>We can now plot the reorganized matrix.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">myBipartiteSBM</span>, dimLabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'fungis'</span>, <span class="st">'tree'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="SBM_fungus_tree_network_files/figure-html/plot%20bipartite-1.png" width="700"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">myBipartiteSBM</span>, type  <span class="op">=</span> <span class="st">'meso'</span>, 
     dimLabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>row <span class="op">=</span> <span class="st">'fungis'</span>, col<span class="op">=</span> <span class="st">'tree'</span><span class="op">)</span>,
     plotOptions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>edge.width <span class="op">=</span> <span class="fl">1</span>, vertex.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="SBM_fungus_tree_network_files/figure-html/plot%20bipartite%20meso-1.png" width="700"></p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor" aria-hidden="true"></a>References</h2>
<div id="refs" class="references">
<div id="ref-blockmodels">
<p>Leger, Jean-Benoist. 2016. “Blockmodels: A R-Package for Estimating in Latent Block Model and Stochastic Block Model, with Various Probability Functions, with or Without Covariates.” <em>arXiv Preprint arXiv:1602.07587</em>.</p>
</div>
<div id="ref-tree_fungus_network">
<p>Vacher, Corinne, Dominique Piou, and Marie-Laure Desprez-Loustau. 2008. “Architecture of an Antagonistic Tree/Fungus Network: The Asymmetric Influence of Past Evolutionary History.” <em>PloS One</em> 3 (3): e1740.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Julien Chiquet, Sophie Donnet, Pierre Barbillon.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
